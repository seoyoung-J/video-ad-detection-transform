# video-ad-detection-transform
**딥러닝 기반 영상 내 옥외광고 탐지 및 이미지 변환**  

YOLOv11과 SAM2 모델을 활용해 영상 내 옥외광고 영역을 자동으로 탐지하고, 탐지된 영역에 새로운 광고 이미지를 삽입하는 과정을 구현한 프로젝트입니다.  

---

### 프로젝트 개요
- **문제 정의**
   - 기존 PPL(간접광고)은 영상 흐름을 방해하고, 시청자 몰입도를 저하시킴
   - 제작 단계에서 광고 계약 및 촬영까지 요구되어 제작 부담이 큼
   - 기존 방식의 비효율성을 해결할 새로운 광고 삽입 방식이 필요
- **프로젝트 목표**
   - 딥러닝 기반 객체 탐지 및 세그멘테이션 모델을 활용해 영상 내 옥외광고 영역을 자동 탐지  
   - 탐지된 광고판 영역을 생성형 AI 기반 이미지로 변환하여 맞춤형 광고 콘텐츠 생성    
- **기간/인원**: 2025.02.10 ~ 2025.03.14 (약 1개월) / 5명
- **담당 역할**
   - YOLOv11 모델 학습 및 SAM2 모델 활용한 광고 영역 분할 처리
   - 영상 전처리 및 후처리
   - 광고 이미지 삽입 로직 개발
- **사용 기술**
   - Python, YOLOv11, SAM2, Supervision, Roboflow, MoviePy, OpenCV, FLUX, LoRA
  
---

### 사용 데이터 
- **옥외광고 이미지 데이터 (Roboflow, billboard 3,999장)**   
   - Train 2,719장 / Validation 510장 / Test 170장
   - YOLOv11 객체 탐지 모델 학습에 사용 
- **영상 데이터**  
  - 광고판이 포함된 여러 편의 실험용 영상  
  - 프레임 단위로 분할하여 광고 이미지 변환 및 삽입 과정 검증에 활용

--- 

### 구현 절차 
#### 1. 영상 전처리
   - Supervision 라이브러리로 영상 → 프레임 분할
   - 첫 번째 프레임은 광고판 크기 측정을 위해 별도 활용  
#### 2. YOLOv11 모델로 광고 영역 탐지  
   - **목적**: 옥외광고 이미지 데이터를 활용해 영상 내 광고판 탐지를 위한 YOLOv11 모델 학습 및 최적 버전 선정
   - **실험 과정**
      - v1: 랜덤 가중치 학습 (20 epoch, imgsz=640)
      - v2: v1 결과 기반 추가 학습 (총 40 epoch, imgsz=960, batch=16, 증강 적용)
      - v3: COCO 사전학습 가중치 활용, 50 epoch 학습 (전이학습)
      - v4: 백본(초기 레이어) 동결 후 YOLO 헤드만 학습 → 이후 전체 Fine-Tuning (20 + 50 epoch)  
   - **최종 선정 모델:** **YOLO11s_v4**
      - Precision 0.729, Recall 0.630, mAP@50-95 0.442  
#### 3. SAM2 모델로 광고 영역 세그멘테이션  
   - **목적**: YOLOv11 탐지 결과로 바운딩 박스를 입력받아 광고판 영역을 정밀하게 분할
   - **사용 모댈/가중치**: SAM2 (사전학습 가중치:sam2_hiera_large.pt)    
   - **절차**:
      - 1. YOLO가 탐지한 광고판 중 가장 신뢰도가 높은 바운딩 박스를 선택
      - 2. 해당 영역을 SAM2 모델에 전달 → 광고판 표면을 세그멘테이션
      - 3. 세그멘테이션 결과에서 광고판 정면 크기(가로·세로 길이) 계산 → 이후 생성형 광고 이미지 크기 산출에 활용
   - **후처리**: 세그멘테이션 번짐 문제 완화  
      - 마스크 영역을 바운딩 박스 내부로 제한
      - 작은 노이즈 제거 및 가우시안 블러 처리 
#### 4. 새로운 광고 이미지 생성  
- FLUX.1 dev 모델 활용 (outpainting)
- 입력: 로고 이미지 + 프롬프트
- 출력: 로고를 포함한 자연스러운 광고 포스터 
#### 5. 영상 프레임별 광고판 변환 로직  
- **목적**: 각 프레임의 광고판 위치·형태에 맞춰 새로운 광고 이미지를 자연스럽게 삽입
- **절차**:
   1. **광고판 꼭짓점 추출**: 세그멘테이션 마스크에서 외곽 윤곽선을 따라 꼭짓점 계산
      - 꼭짓점이 4개 이상 추출된 경우, 이전 프레임의 좌표를 보간해 안정성 확보
   2. **크기 계산**: 꼭짓점 간 유클리드 거리로 광고판 정면의 가로·세로 길이 산출
   3. **원근 변환**: 기울어진 광고판을 정면 기준으로 보정 (Perspective Transform)
   4. **이미지 삽입**: 생성형 광고 이미지를 투명도(알파 블렌딩) 적용 후 광고판 위치에 합성
#### 6. 영상 재생성  
- MoviePy 활용 → 변환된 프레임 합성 → 원본 FPS로 재구성  

---

### 기대 효과  
- **광고 효율성 향상**: 영상의 흐름을 해치지 않고 자연스럽게 광고를 변환·삽입하여 시청 몰입도를 유지  
- **제작 비용 절감**: 기존처럼 촬영 단계에서 별도 광고 계약·촬영을 진행할 필요 없이 후처리로 광고 교체 가능
  
---  

### 참고 자료 
- 상세 분석 과정은 [Notion](https://www.notion.so/2089627a91c780fcade0d705544b2633?source=copy_link)에 정리되어 있습니다. 
